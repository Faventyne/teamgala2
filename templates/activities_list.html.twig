 {% extends "layout.html.twig" %}

{% block title %}
Activity list
{% endblock %}

{% block pagename %}
Activity list
{% endblock %}

{% block username %}
{{ currentuser.firstname }} {{ currentuser.lastname }}
{% endblock %}

{% block content %}
  <section class="col s10">
<div class="" style="opacity: 0.00001;">
aempty div used to circumnavigate the materialise bug which moves the first badge element of the list
</div>
    {% for activity in user_activities %}
      <ul id="ListButtons" class="collapsible expandMore expandLess" data-collapsible="accordion">
        <li>
          <div class="collapsible-header">
            <i id="expand" class="material-icons">expand_more</i>
            <!-- just giving the name an absolute position because it was interfering ith the button position -->
            <div id="activityListDiv" style="margin-left: 10vw; font-size: 4vw; ">
              {{ activity['act_name']  }}
              <br>
              <span id="activityListSpan" style="font-size: 2.5vw; "> {{ activity['act_objectives']  }}</span>
            </div>

            {% if activity['act_status'] == 0 %}
              <span id="gradeBadge" class="new badge light-blue darken-2"> To be graded </span>
            {% elseif activity['act_status'] == 1 %}
              <span id="gradeBadge" class="new badge blue-grey"> In progress </span>
            {% elseif activity['act_status'] == 2 %}
              <span id="gradeBadge" class="new badge green darken-3"> Graded </span>
            {% endif %}


                {# if user is not a simple collaborator #}
                <!-- i had to make a div to contain the buttons because of marginalise and did the style inside
                 it to override the important aspects of all the classes -->


          </div>

          <div class="collapsible-body">
              <div class="row">
                  <div class="col s12 m12" name="details-title">
                      Details
                  </div>
              </div>
            <div class="row">
                <div class="col s6 m4">
                    <i class="fa fa-clock-o" aria-hidden="true"></i> Grades deadline :
                </div>
                <div class="col s6 m4">
                    {{ activity['act_quotes_deadline']|date('j F Y') }}
                </div>
            </div>
            <div class="row">
                <div class="col s12 m4">
                    <i class="fa fa-tasks" aria-hidden="true"></i> Progress :
                </div>
                <div class="col s8 m4">
                    <div class="progress"><div class="determinate col s10 m10" style="width: {{ activity['act_progress'] }}%"></div></div>
                </div>
                <div class="col s4 m3">
                    {{ activity['act_progress'] }}%
                </div>
            </div>
              <div class="row">
                  <div class="col s6 m4">
                      <i class="fa fa-users" aria-hidden="true"></i> Participants :
                  </div>
                  <div class="col s6 m4">
                      {{ activity['act_nbParticipants'] }}
                  </div>
              </div>

            <br>

              {#
              As there is only one criterion, weight is not worth displaying. Other parameters which are not that relevant are stored here
               from {{ activity['cri_lowerbound']  }} to {{ activity['cri_upperbound']  }} (increment : {{ activity['cri_step']  }})
              {{ activity['weight']  }}
              #}

            <div class="row">
              {% if is_granted('ROLE_ACTIVITY_MANAGER') or is_granted('ROLE_HR') or is_granted('ROLE_COLLABORATOR') %}

                  {% if activity['act_status'] != 2 %}

                        <div class="button-field col
                            {% if activity['act_status'] == 0 %}
                            s6
                            {% else %}
                            s4
                            {% endif %}
                        ">
                            {% if is_granted('ROLE_ACTIVITY_MANAGER') or is_granted('ROLE_HR') %}
                            <form action="{{ url('activityModify',{'actId' : activity['act_id']}) }}">
                                <button type="submit" class="validate"> MODIFY </button>
                            </form>
                            {% endif %}
                        </div>

                        {% if (activity['isParticipant'] == 1  and  is_granted(['ROLE_ACTIVITY_MANAGER', 'ROLE_COLLABORATOR','ROLE_HR'])) %}
                            <div class="button-field col
                            {% if activity['act_status'] == 0 %}
                            s6
                            {% else %}
                            s4
                            {% endif %}
                            ">
                                <form action="{{ url('activityGrade',{'actId' : activity['act_id']})}}">
                                    <button type="submit" class="validate"> GRADE </button>
                                </form>
                            </div>
                        {% else %}
                            <div class="button-field col
                            {% if activity['act_status'] == 0 %}
                            s6
                            {% else %}
                            s4
                            {% endif %}
                            ">
                                <a href=""><button style="background-color: red;" ><i class="fa fa-ban" aria-hidden="true"></i> GRADE </button></a>
                            </div>
                        {% endif %}
                  {% else %}
                        <div class="button-field col s12">
                            <button id="" type="submit" class="validate" style="margin-left: 36%;">
                                <a href="{{ url('activityResults',{'actId' : activity['act_id']}) }}" style="color: white;">RESULTS</a>
                            </button>
                        </div>
                  {% endif %}
              {% endif %}

            </div>
          </div>
        </li>
      </ul>
    {% endfor %}
    <ul id="hiddenul" class="collection">
      <li class="collection-item"></li>
      <br><br> <!-- empt ul to make space for fixed add button -->
    </ul>
    <div id="fixedButton" class="fixed-action-btn">
            <a href="{{ path('activityCreationParameters') }}"><button type="submit" class="waves-effect waves-light btn-large green accent-4">ADD ACTIVITY</button></a>
    </div>
  </section>

{% endblock %}
